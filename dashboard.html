<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Leave Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:#f2f5f9;
}
.header{
  background:#1e3c72;
  color:white;
  padding:15px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.card{
  background:white;
  margin:20px;
  padding:20px;
  border-radius:12px;
  box-shadow:0 5px 15px rgba(0,0,0,.1);
}
.tabs{
  display:flex;
  margin:20px;
}
.tabs button{
  flex:1;
  padding:12px;
  border:none;
  cursor:pointer;
  background:#ddd;
  font-weight:bold;
}
.tabs button.active{
  background:#1e3c72;
  color:white;
}
.hidden{display:none;}
table{
  width:100%;
  border-collapse:collapse;
}
td{
  padding:10px;
  border-bottom:1px solid #eee;
}
.logout{
  background:red;
  color:white;
  border:none;
  padding:8px 14px;
  border-radius:6px;
  cursor:pointer;
}
</style>
</head>
<body>

<div class="header">
  <div id="userInfo"></div>
  <button class="logout" onclick="logout()">Logout</button>
</div>

<div class="tabs">
  <button id="tab1" class="active" onclick="showTab(1)">Annual Leave</button>
  <button id="tab2" onclick="showTab(2)">Leave Tracking</button>
</div>

<div id="content1" class="card"></div>
<div id="content2" class="card hidden">
  <h3>Monthly Leave Tracking</h3>
  <p>Coming soon / can be linked to monthly sheet</p>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbxhcanAcUP06XdvwJFuFioqqNF_CxICBEFMOHBLaCFDa5eVF3oiasFfK__giFWJXgMLqw/exec";

// Session check
const privyId=localStorage.getItem("privyId");
if(!privyId){
  window.location="login.html";
}

// Load user leave
fetch(API+"?mode=leave&id="+privyId)
.then(r=>r.json())
.then(d=>{
  if(d.status!="ok"){logout();return;}

  document.getElementById("userInfo").innerText=
    d.name+" - "+d.position;

  document.getElementById("content1").innerHTML=`
  <h3>Annual Leave Summary</h3>
  <table>
    <tr><td>Annual Leave</td><td>${d.annual}</td></tr>
    <tr><td>Bonus Annual Leave</td><td>${d.bonus}</td></tr>
    <tr><td>Total Annual Leave</td><td>${d.total}</td></tr>
    <tr><td>Leave Taken</td><td>${d.taken}</td></tr>
    <tr><td>Year-End Leave Balance</td><td>${d.yearEnd}</td></tr>
    <tr><td><b>Available Leave</b></td><td><b>${d.available}</b></td></tr>
  </table>
  `;
});

function logout(){
  localStorage.clear();
  window.location="login.html";
}

function showTab(n){
  document.getElementById("content1").classList.toggle("hidden",n!=1);
  document.getElementById("content2").classList.toggle("hidden",n!=2);
  document.getElementById("tab1").classList.toggle("active",n==1);
  document.getElementById("tab2").classList.toggle("active",n==2);
}
</script>

</body>
</html>
